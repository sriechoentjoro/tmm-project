<!DOCTYPE html>
<html>
<head>
    <title>Test Search API</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .test { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .result { background: #f5f5f5; padding: 10px; margin-top: 10px; white-space: pre-wrap; }
        button { padding: 8px 15px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Apprentice Search API Test</h1>
    
    <div class="test">
        <h3>Test 1: No filters (should return all 10 records for order_id=4)</h3>
        <button onclick="test1()">Run Test 1</button>
        <div id="result1" class="result"></div>
    </div>
    
    <div class="test">
        <h3>Test 2: Name contains "ni" only</h3>
        <button onclick="test2()">Run Test 2</button>
        <div id="result2" class="result"></div>
    </div>
    
    <div class="test">
        <h3>Test 3: File exists only</h3>
        <button onclick="test3()">Run Test 3</button>
        <div id="result3" class="result"></div>
    </div>
    
    <div class="test">
        <h3>Test 4: Name contains "ni" AND file exists (YOUR FAILING CASE)</h3>
        <button onclick="test4()">Run Test 4</button>
        <div id="result4" class="result"></div>
    </div>
    
    <script>
        function test1() {
            fetch('/project_tmm/apprentice-orders/search-apprentices?apprentice_order_id=4&page=1&limit=50')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('result1').textContent = 
                        'Total: ' + data.total + '\n' +
                        'Records: ' + data.records.length + '\n' +
                        JSON.stringify(data, null, 2);
                })
                .catch(err => {
                    document.getElementById('result1').textContent = 'ERROR: ' + err;
                });
        }
        
        function test2() {
            const filters = JSON.stringify({"name":{"value":"ni","operator":"contains"}});
            fetch('/project_tmm/apprentice-orders/search-apprentices?apprentice_order_id=4&page=1&limit=50&filters=' + encodeURIComponent(filters))
                .then(r => r.json())
                .then(data => {
                    document.getElementById('result2').textContent = 
                        'Total: ' + data.total + '\n' +
                        'Records: ' + data.records.length + '\n' +
                        'Names: ' + data.records.map(r => r.name).join(', ') + '\n\n' +
                        JSON.stringify(data, null, 2);
                })
                .catch(err => {
                    document.getElementById('result2').textContent = 'ERROR: ' + err;
                });
        }
        
        function test3() {
            const filters = JSON.stringify({"image_photo":{"value":"","operator":"file_exists"}});
            fetch('/project_tmm/apprentice-orders/search-apprentices?apprentice_order_id=4&page=1&limit=50&filters=' + encodeURIComponent(filters))
                .then(r => r.json())
                .then(data => {
                    document.getElementById('result3').textContent = 
                        'Total: ' + data.total + '\n' +
                        'Records: ' + data.records.length + '\n\n' +
                        JSON.stringify(data, null, 2);
                })
                .catch(err => {
                    document.getElementById('result3').textContent = 'ERROR: ' + err;
                });
        }
        
        function test4() {
            const filters = JSON.stringify({"name":{"value":"ni","operator":"contains"},"image_photo":{"value":"","operator":"file_exists"}});
            fetch('/project_tmm/apprentice-orders/search-apprentices?apprentice_order_id=4&page=1&limit=50&filters=' + encodeURIComponent(filters))
                .then(r => r.json())
                .then(data => {
                    document.getElementById('result4').textContent = 
                        'Total: ' + data.total + '\n' +
                        'Records: ' + data.records.length + '\n' +
                        'EXPLANATION: If total=0, it means NO apprentices have BOTH:\n' +
                        '  1. Name containing "ni" AND\n' +
                        '  2. A photo file\n\n' +
                        JSON.stringify(data, null, 2);
                })
                .catch(err => {
                    document.getElementById('result4').textContent = 'ERROR: ' + err;
                });
        }
    </script>
</body>
</html>
